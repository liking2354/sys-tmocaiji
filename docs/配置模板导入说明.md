# 配置模板导入说明

## 概述

配置模板功能允许您创建可重复使用的配置变更规则，支持批量修改服务器配置文件。

## 模板文件格式

配置模板使用JSON格式，包含以下主要字段：

### 基本信息
- `name`: 模板名称（必需）
- `description`: 模板描述
- `template_type`: 模板类型（mixed/directory/file/string）
- `is_active`: 是否启用（true/false）

### 配置规则 (config_rules)

支持三种类型的配置规则：

#### 1. 目录批量处理 (directory)
```json
{
    "type": "directory",
    "description": "批量处理目录中的配置文件",
    "directory": "/etc/nginx/conf.d",
    "pattern": "*.conf",
    "variables": [
        {
            "variable": "server_name",
            "match_type": "key_value",
            "match_pattern": "server_name"
        }
    ]
}
```

#### 2. 单文件处理 (file)
```json
{
    "type": "file",
    "description": "修改特定配置文件",
    "file_path": "/etc/nginx/nginx.conf",
    "variables": [
        {
            "variable": "worker_processes",
            "match_type": "key_value",
            "match_pattern": "worker_processes"
        }
    ]
}
```

#### 3. 字符串替换 (string)
```json
{
    "type": "string",
    "description": "字符串替换示例",
    "file_path": "/etc/hosts",
    "search_string": "127.0.0.1 localhost",
    "replace_string": "127.0.0.1 localhost {{hostname}}"
}
```

### 模板变量 (template_variables)

定义模板中使用的变量：

```json
{
    "name": "server_name",
    "description": "服务器域名",
    "default_value": "example.com",
    "required": true
}
```

## 变量匹配类型

- `key_value`: 键值对匹配，如 `server_name example.com`
- `regex`: 正则表达式匹配
- `exact`: 精确匹配

## 使用步骤

1. **下载样例模板**
   - 在配置模板管理页面点击"导入模板"
   - 在弹出的对话框中点击"下载样例模板"

2. **编辑模板文件**
   - 根据实际需求修改配置规则
   - 更新变量定义
   - 确保变量名在配置规则和变量定义中保持一致

3. **导入模板**
   - 保存编辑后的JSON文件
   - 在导入对话框中选择文件并上传

## 注意事项

- 文件路径必须是绝对路径
- 目录路径必须存在于目标服务器上
- 变量名只能包含字母、数字和下划线
- `search_string` 必须能在目标文件中找到
- JSON文件必须格式正确，建议使用JSON验证工具检查

## 常见问题

### Q: 导入时提示"JSON文件格式错误"
A: 请检查JSON语法是否正确，特别注意逗号、引号和括号的使用。

### Q: 模板导入成功但执行时找不到文件
A: 请确认文件路径在目标服务器上确实存在。

### Q: 变量替换不生效
A: 检查变量名是否在 `config_rules` 和 `template_variables` 中都有定义，且名称完全一致。

## 示例场景

### 场景1: Nginx配置批量更新
适用于需要同时更新多个虚拟主机配置的情况。

### 场景2: 应用配置文件更新
适用于更新应用程序的数据库连接、缓存配置等。

### 场景3: 系统配置标准化
适用于将多台服务器的系统配置统一为标准配置。